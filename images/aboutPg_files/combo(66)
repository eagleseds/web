YUI.add("standard-comment-list-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.Views["comment-list-view"],[],{langBundles:this.details.langBundles,initializer:function(e){this.constructor.superclass.initializer.call(this,e)},buildContainer:function(){this.setContainerWithTemplate("standard-comment-list-view",this.params)},activate:function(){var e=this.get("container");this.listContainerNode=e.one(".comment-list-container"),this.loadMoreButton=e.one(".load-more-button"),this.registerEventHandler(this.loadMoreButton.on("click",this.handleLoadMoreClick.bind(this))),this.constructor.superclass.activate.call(this)},setLoading:function(e){this.isLoading=e,this.listContainerNode.toggleClass("loading",e)},handleLoadCommentsComplete:function(){this.listContainerNode.removeClass("loading")},showCommentLoading:function(e){e?this.showBalls(!1):this.hideBalls()},showCommentAddLoading:function(e){e?this.showBalls(!0):this.hideBalls()},updateComments:function(t){return t?(this.updateLoadButton(),this.prependComments(t)):e.Promise.resolve()},prependComments:function(t){var i=this,n=[],o=[];return t.forEach(function(t){var s=t.toJSON(),a=Object.assign(s,{appContext:i.appContext,showPermalink:i.commentsViewHelper.config.commentListConfig.showPermalinks});a.isSubjectOwner=i.commentsViewHelper.commentsObj.isSubjectOwner;var m=new e.Views["comment-item-view"](a),r=m.initialize(a).then(function(){m.activate()});o.push(m),n.push(r)}),e.Promise.all(n).then(function(){i.prependCommentViewsToDom(o)})},prependCommentViewsToDom:function(t){var i,n=this;t.forEach(function(t){(i=e.Node.create('<li class="comment-list-item"></li>')).append(t.get("container")),n.commentsListNode.prepend(i)}),this.commentsViewHelper.commentsObj.flimojiParser.emojifyTarget({inputElements:["["+e.config.flickr.emojis.parserAttr+"]"],useSprites:!1,iconsPath:e.config.flickr.urls.assetRoot+"/images/joypixels",container:this.get("container").getDOMNode()})},handleLoadMoreClick:function(){var e=this;this.isFetchingComments||this.getMoreComments().then(function(){e.updateLoadButton()})},updateLoadButton:function(){var e;e=this.commentsViewHelper.getLoadButtonMessage(),this.loadMoreButton.toggleClass("hidden",!!this.commentsViewHelper.commentsObj.endOfComments),this.loadMoreButton.set("text",e)}})},"@VERSION@",{requires:["flickr-view","comment-list-view","hermes-template-standard-comment-list-view"],langBundles:["common","comments","photo-page-scrappy"]});YUI.add("hermes-template-photo-comments-view",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,l,a){return" scrollable"},3:function(e,t,n,l,a){return"\t\t\t"+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(null!=t?t:{},null!=t?t["scrollable-comment-list-view"]:t,{name:"outlet",hash:{},data:a}))+"\n"},5:function(e,t,n,l,a){return"\t\t\t"+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(null!=t?t:{},null!=t?t["standard-comment-list-view"]:t,{name:"outlet",hash:{},data:a}))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,l,a){var s,i=null!=t?t:{};return'<div class="photo-comments with-emoji-picker'+(null!=(s=n.if.call(i,null!=t?t.isScrollable:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?s:"")+'">\n\t<section class="comments-list-section">\n'+(null!=(s=n.if.call(i,null!=t?t.isScrollable:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.program(5,a,0),data:a}))?s:"")+'\t</section>\n\n\t<section class="add-comment-section">\n\t\t'+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(i,null!=t?t["add-comment-view"]:t,{name:"outlet",hash:{},data:a}))+"\n\t</section>\n</div>\n"},useData:!0}),l={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(l[t]=n)}),e.Template.register("hermes/photo-comments-view",function(t,a){return a=a||{},a.partials=a.partials?e.merge(l,a.partials):l,n(t,a)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-comment-edit",function(t,e){var n=t.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(t,e,n,a,s){var i,l=null!=e?e:{},m=n.helperMissing,o=t.escapeExpression;return'<div class="comment-edit">\n\t<textarea class="edit-field">'+o("function"==typeof(i=null!=(i=n.content||(null!=e?e.content:e))?i:m)?i.call(l,{name:"content",hash:{},data:s}):i)+'</textarea>\n\t<div class="buttons edit-comment-buttons">\n\t\t<button type="button" class="mini alt cancel-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:s}))+'</button>\n\t\t<button type="button" class="mini action submit-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.DONE"},data:s}))+"</button>\n\t</div>\n</div>"},useData:!0}),a={};t.Array.each([],function(e){var n=t.Template.get("hermes/"+e);n&&(a[e]=n)}),t.Template.register("hermes/comment-edit",function(e,s){return s=s||{},s.partials=s.partials?t.merge(a,s.partials):a,n(e,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("comments-view-helper",function(e,t){require("hermes-core/flog")(t);var o=e.mix({langBundles:["common","comments","photo-page-scrappy"]},e.Localizable);e.CommentsViewHelper=function(t,n){var i=n,s=n.commentListConfig,m=(n.addCommentConfig,{commentsObj:new{photo:function(){return{load:function(){var o,n=this,m=/#comment/g;YUI.Env.isServer||(o=e.config.win.location.hash),this.renderedCommentModels=[],this.commentingEnabled=!0,this.perPage=s.modelConfig.perPage,this.firstPerPage=s.modelConfig.firstPerPage,this.permalinkHash=o;var l=[t.getModelRegistry(s.modelConfig.commentModelRegistryName).then(function(e){n.commentModelRegistry=e}),t.getModel("photo-engagement-models",i.photoId).then(function(e){n.engagementModel=e,o&&m.test(o)&&(n.perPage=this.engagementModel.getValue("commentCount"),n.firstPerPage=this.engagementModel.getValue("commentCount"))}.bind(this)),t.getModel("photo-models",{id:i.photoId}).then(function(e){n.photoModel=e,n.commentingEnabled=!t.getViewer().signedIn||n.photoModel.getValue("canComment")})];if(t.getViewer().signedIn&&l.push(t.getModel("person-models",{id:t.getViewer().nsid}).then(function(e){n.userModel=e})),!this.flimojis){var r=require("@flickr/flimojis");this.flimojiParser=new r.EmojiParser}return e.Promise.all(l)},loadComments:function(){var o=this,n=[];return n.push(t.getModel(s.modelConfig.listRegistryName,{id:s.modelConfig.modelId}).then(function(e){o.listModel=e})),n.push(t.getModel("photo-models",s.modelConfig.modelId).then(function(e){o.isSubjectOwner=t.getViewer().nsid===e.getValue("owner").getValue("nsid")})),n.push(t.getModel("photo-engagement-models",i.photoId).then(function(e){o.engagementModel=e})),e.Promise.all(n)},getLoadButtonMessage:function(){var e=this.calculateRemainingCount();return o.intlMessage({intlName:"photo-page-scrappy.VIEW_MORE_PREVIOUS_COMMENTS",count:e})},calculateRemainingCount:function(){var e=this.listModel.getValue(s.modelConfig.collectionName),t=this.engagementModel.getValue("commentCount"),o=e.getList().length;return t>o+s.modelConfig.perPage?s.modelConfig.perPage:t<=o+s.modelConfig.perPage?t-o:0},getPlaceholderMessage:function(){return o.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:this.photoModel.getValue("mediaType")})},deleteComment:function(e){return this.commentModelRegistry.remoteDelete(e)},updateComment:function(e,t){var o=this;return this.commentModelRegistry.get(e).then(function(n){return n.setValue("content",t),o.commentModelRegistry.remoteUpdate(e)})},addComment:function(e){return this.commentModelRegistry.remoteCreate({photoId:i.photoId,commentText:e})},getMoreComments:function(){var t=this,o=this.isFirstPageRendered?this.perPage:this.firstPerPage,n=this.renderedCommentModels.length,i=this.renderedCommentModels.length,m=t.listModel.getValue(s.modelConfig.collectionName).getList(),l=[];if(0===this.engagementModel.getValue("commentCount"))return this.endOfComments=!0,e.Promise.resolve();if(m.length>=n+o||this.endOfComments){for(var r=n;r<n+o;r++)m[r]&&l.push(m[r]);return e.Promise.resolve(l)}return this.listModel.getValue(s.modelConfig.collectionName).getRange({offset:i,limit:o}).then(function(e){return(e.length<o||t.listModel.getValue(s.modelConfig.collectionName).getList().length>=t.engagementModel.getValue("commentCount"))&&(t.endOfComments=!0),e.forEach(function(e){t.renderedCommentModels.push(e)}),e})}}},gallery:function(){return{load:function(){var o=this;this.renderedCommentModels=[],this.commentingEnabled=!0;var n=[t.getModelRegistry(s.modelConfig.commentModelRegistryName).then(function(e){o.commentModelRegistry=e}),t.getModel("gallery-info-models",{id:i.galleryId}).then(function(e){o.galleryInfoModel=e})];if(t.getViewer().signedIn&&n.push(t.getModel("person-models",{id:t.getViewer().nsid}).then(function(e){o.userModel=e})),!this.flimojis){var m=require("@flickr/flimojis");this.flimojiParser=new m.EmojiParser}return e.Promise.all(n)},loadComments:function(){var e=this;return t.getModel(s.modelConfig.listRegistryName,{id:s.modelConfig.modelId}).then(function(o){return e.listModel=o,e.isSubjectOwner=t.getViewer().signedIn&&t.getViewer().nsid===o.getValue("owner").getValue("nsid"),o})},getLoadButtonMessage:function(){var e=this.calculateRemainingCount();return o.intlMessage({intlName:"photo-page-scrappy.VIEW_MORE_PREVIOUS_COMMENTS",count:e})},calculateRemainingCount:function(){var e=this.listModel.getValue(s.modelConfig.collectionName),t=e.totalItems>e.getList().length?e.totalItems-e.getList().length:0;return t>s.modelConfig.perPage?s.modelConfig.perPage:t},getPlaceholderMessage:function(){return o.intlMessage({intlName:"comments.ADD_GALLERY_COMMENT"})},deleteComment:function(e){return this.commentModelRegistry.deleteRemote(e)},updateComment:function(e,t){return this.commentModelRegistry.updateRemote(e,t)},addComment:function(e){return this.commentModelRegistry.remoteCreate({galleryId:this.listModel.getValue("id"),galleryOwnerId:this.listModel.getValue("owner").getValue("id"),commentText:e,authorId:this.userModel.getValue("id")})},getMoreComments:function(){var t=this,o=this.isFirstPageRendered?s.modelConfig.perPage:s.modelConfig.firstPerPage,n=this.listModel.getValue(s.modelConfig.collectionName).getList(),i=this.renderedCommentModels.length,m=[];if(n.length>=i+o||"-1"===t.listModel.getValue(s.modelConfig.listRegistryContinuationName)){for(var l=i;l<i+o;l++)n[l]&&m.push(n[l]);return e.Promise.resolve(m)}return this.listModel.getCommentsByContinuation(o).then(function(e){return"-1"===t.listModel.getValue(s.modelConfig.listRegistryContinuationName)&&(t.endOfComments=!0),e.forEach(function(e){t.renderedCommentModels.push(e)}),e})},reset:function(){this.renderedCommentModels=[],this.isFirstPageRendered=!1,this.endOfComments=!1;var e=this.listModel.getValue(s.modelConfig.collectionName);e.getList().forEach(function(t){e.remove(t.id)}),this.listModel.setValue(s.modelConfig.listRegistryContinuationName,"0")}}}}[i.type],config:i,loadPromise:void 0,load:function(){return this.loadPromise||(this.loadPromise=this.commentsObj.load()),this.loadPromise},loadComments:function(){return this.commentsObj.loadComments()},addComment:function(e){return this.commentsObj.addComment(e)},deleteComment:function(e){return this.commentsObj.deleteComment(e)},updateComment:function(e,t){return this.commentsObj.updateComment(e,t)},getLoadButtonMessage:function(){return this.commentsObj.getLoadButtonMessage()},getPlaceholderMessage:function(){return this.commentsObj.getAddPlaceholderMessage()},getMoreComments:function(){return this.commentsObj.getMoreComments()},reset:function(){return this.commentsObj.reset()}});return e.augment(m,e.EventTarget),m}},"@VERSION@",{requires:["event-custom"],langBundles:["common","comments","photo-page-scrappy"],optionalRequires:["flimojis"]});YUI.add("photo-comments-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var i;YUI.Env.isServer||(i=e.config.win.location.hash),this.params=t,this.config=this.params.photoCommentsViewConfig||this.params||{},this.signedIn=this.appContext.getViewer().signedIn,this.commentsViewHelper=new e.CommentsViewHelper(this.appContext,{photoId:this.config.photoId,type:"photo",commentListConfig:{type:"photo",isScrollable:this.config.isScrollable,showPermalinks:this.config.showPermalinks,modelConfig:{listRegistryName:"photo-comments-models",modelId:this.config.photoId,collectionName:"comments",commentModelRegistryName:"comment-models",perPage:this.config.perPage||200,firstPerPage:this.config.firstPerPage||16,loadAllInitially:i&&/#comment/g.test(i)}},addCommentConfig:{type:"photo",addCommentText:this.config.addCommentText,modelConfig:{commentModelRegistryName:"comment-models"}}}),this.params.commentListConfig=Object.assign({commentsViewHelper:this.commentsViewHelper},this.commentsViewHelper.config.commentListConfig),this.params.addCommentConfig=Object.assign({commentsViewHelper:this.commentsViewHelper},this.commentsViewHelper.config.addCommentConfig)},subviewConfig:{"scrollable-comment-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"standard-comment-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"add-comment-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){return this.commentsViewHelper.load()},buildContainer:function(){this.setContainerWithTemplate("photo-comments-view",{user:this.signedIn?this.commentsViewHelper.commentsObj.userModel.toJSON():null,signedIn:this.signedIn,isScrollable:this.config.isScrollable})},activate:function(){this.get("container");this.config.isScrollable?this.commentListView=this.subviews["scrollable-comment-list-view"]:this.commentListView=this.subviews["standard-comment-list-view"],this.addCommentView=this.subviews["add-comment-view"]},delayPromise:function(t,i){return new e.Promise(function(e){setTimeout(function(){return e(i())},t)})},onSubviewEvent:function(e,t){var i;if(t&&t[0])switch((i=t[0]).eventName){case"replyClicked":this.addCommentView.addReplyMessage(i.pathAliasOrNSID,!1);break;case"emptyCommentContainer":this.addCommentView.focusCommentBox();break;case"commentAddLoading":this.commentListView.showCommentAddLoading(i.isLoading);break;case"commentAdded":this.commentListView.appendNewComment(i.commentModel),this.commentsViewHelper.commentsObj.listModel.getValue(this.params.commentListConfig.modelConfig.collectionName).prependToList(i.commentModel),this.commentsViewHelper.commentsObj.engagementModel.setValue("commentCount",this.commentsViewHelper.commentsObj.engagementModel.getValue("commentCount")+1),this.fire("commentAdded");break;case"commentDeleted":this.commentsViewHelper.commentsObj.listModel.getValue(this.params.commentListConfig.modelConfig.collectionName).removeFromList(i.commentModelId),this.commentsViewHelper.commentsObj.engagementModel.setValue("commentCount",this.commentsViewHelper.commentsObj.engagementModel.getValue("commentCount")-1),this.fire("commentDeleted")}}})},"@VERSION@",{requires:["flickr-view","comment-item-view","add-comment-view","scrollable-comment-list-view","standard-comment-list-view","hermes-template-photo-comments-view","hermes-template-comment-edit","comments-view-helper"],langBundles:["gallery","stats","comments","common"]});YUI.add("hermes-template-stuff-creation-view",function(e,t){var a=e.Template.Handlebars.revive({1:function(e,t,a,n,l){return"large"},3:function(e,t,a,n,l){return'<div class="error-message create-error hidden"></div>'},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,l){var i,r,s=null!=t?t:{},c=a.helperMissing,o="function",u=e.escapeExpression;return'<div class="stuff-creation-container '+(null!=(i=a.if.call(s,null!=t?t.isLarge:t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?i:"")+'">\n\t<header>\n\t\t<h1 class="stuff-creation-heading">'+u(typeof(r=null!=(r=a.heading||(null!=t?t.heading:t))?r:c)===o?r.call(s,{name:"heading",hash:{},data:l}):r)+'</h1>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\t<div class="input-item title-input-item">\n\t\t<input class="input-field stuff-creation-title" type="text" placeholder="'+u(typeof(r=null!=(r=a.placeholderTitle||(null!=t?t.placeholderTitle:t))?r:c)===o?r.call(s,{name:"placeholderTitle",hash:{},data:l}):r)+'">\n\t\t<div class="error-message title-error"></div>\n\t</div>\n\t<textarea class="input-field stuff-creation-description" placeholder="'+u(typeof(r=null!=(r=a.placeholderDescription||(null!=t?t.placeholderDescription:t))?r:c)===o?r.call(s,{name:"placeholderDescription",hash:{},data:l}):r)+'"></textarea>\n\t<div class="create-footer">\n\t\t'+(null!=(i=a.if.call(s,null!=t?t.isLarge:t,{name:"if",hash:{},fn:e.noop,inverse:e.program(3,l,0),data:l}))?i:"")+'\n\t\t<div class="buttons">\n\t\t\t'+(null!=(i=a.if.call(s,null!=t?t.isLarge:t,{name:"if",hash:{},fn:e.program(3,l,0),inverse:e.noop,data:l}))?i:"")+'\n\t\t\t<button class="alt button mini button-cancel">'+u(typeof(r=null!=(r=a.cancelText||(null!=t?t.cancelText:t))?r:c)===o?r.call(s,{name:"cancelText",hash:{},data:l}):r)+'</button>\n\t\t\t<button class="button mini button-action">'+u(typeof(r=null!=(r=a.actionText||(null!=t?t.actionText:t))?r:c)===o?r.call(s,{name:"actionText",hash:{},data:l}):r)+"</button>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/stuff-creation-view",function(t,l){return l=l||{},l.partials=l.partials?e.merge(n,l.partials):n,a(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("stuff-creation-view",function(t,e){t.namespace("Views")[this.name]=t.Base.create("stuff-creation-view",t.FlickrView,[],{initializer:function(t){return this.params=t,this.heading=t.heading,this.placeholderTitle=t.placeholderTitle,this.placeholderDescription=t.placeholderDescription,this.cancelText=t.cancelText,this.actionText=t.actionText,this.inlineCreation=t.inlineCreation,this},buildContainer:function(){return this.setContainerWithTemplate("stuff-creation-view",{heading:this.heading,placeholderTitle:this.placeholderTitle,placeholderDescription:this.placeholderDescription,cancelText:this.cancelText,actionText:this.actionText,isLarge:this.params.useLargeLayout}),this},activate:function(){return this.isCreating=!1,this},showError:function(t,e,i){i&&t.set("text",i),e?t.removeClass("hidden"):t.addClass("hidden")},showTitleError:function(t,e){this.titleItemNode.toggleClass("error",t),e&&this.titleErrorNode.set("text",e)},destructor:function(){this.closeTimer&&clearTimeout(this.closeTimer)},resetView:function(){this.buildContainer(),this.activate()},createCuration:function(){var e=this;return this.isCreating?t.Promise.reject():(this.isCreating=!0,this.actionButton.setAttribute("disabled"),this.createNewAndAddPhoto().then(function(t){return e.isCreating=!1,e.actionButton.removeAttribute("disabled"),t}).catch(function(t){throw e.isCreating=!1,e.actionButton.removeAttribute("disabled"),t}))},focusInitial:function(){}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-stuff-creation-view"]});YUI.add("album-creation-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("album-creation-view",e.Views["stuff-creation-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return e.heading=this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_A_NEW_ALBUM"}),e.placeholderTitle=this.intlMessage({intlName:"add-to-stuff.CURATIONS_ALBUM_NAME"}),e.placeholderDescription=this.intlMessage({intlName:"add-to-stuff.CURATIONS_DESCRIPTION_OPTIONAL"}),e.cancelText=this.intlMessage({intlName:"common.CANCEL"}),e.actionText=this.intlMessage({intlName:"global-nav.CREATE"}),this.photoId=e.photoId,this.dismissOnCreate=e.dismissOnCreateAlbum,this.curationType="album",this.photoIds=e.photoIds,this.titleError=this.intlMessage({intlName:"add-to-stuff.PLEASE_ENTER_ALBUM_NAME"}),this.createError=this.intlMessage({intlName:"add-to-stuff.COULDNT_SAVE_ALBUM"}),this.constructor.superclass.initializer.call(this,e)},activate:function(){var e=this.get("container");this.titleItemNode=e.one(".input-item.title-input-item"),this.titleErrorNode=e.one(".error-message.title-error"),this.createErrorNode=e.one(".error-message.create-error"),this.titleNode=e.one(".stuff-creation-title"),this.descriptionNode=e.one(".stuff-creation-description"),this.cancelButton=e.one(".button-cancel"),this.actionButton=e.one(".button-action"),this.closeButton=e.one(".close-x-button"),this.setupEvents(),this.constructor.superclass.activate.call(this,this.params)},setupEvents:function(){var e=this;this.get("container");this.registerEventHandler(this.titleNode.on("keyup",function(){e.titleNode.get("value")&&e.showTitleError(!1)})),this.registerEventHandler(this.cancelButton.on("click",function(){e.fire("cancel"),e.resetView()})),this.registerEventHandler(this.closeButton.on("click",function(){e.fire("readyToClose")})),this.registerEventHandler(this.actionButton.on("click",function(){e.createCuration()}))},createNewAndAddPhoto:function(){var t,o=this,s=!!this.photoIds,n=this.titleNode.get("value"),r=this.descriptionNode.get("value");return n?(t={photoID:s?this.photoIds[0]:this.photoId,title:n,description:r,isMultiplePhotos:s,numberOfPhotosSelected:o.params.numberOfPhotosSelected,numberOfVideosSelected:o.params.numberOfVideosSelected},this.appContext.getModelRegistry("set-models").then(function(e){return o.albumsModel=e,e.remote.create(t,o.appContext)}).then(function(e){return s&&o.photoIds.slice(1).length>0?o.addPhotos(e.getValue("id"),o.photoIds).then(function(){return e}):e}).then(function(e){return o.titleNode.set("value",""),o.descriptionNode.set("value",""),o.fire("created",{type:o.curationType,curation:e}),o.params.inlineCreation?o.resetView():o.fire("readyToClose"),e}).catch(function(e){throw i.error("Error handling photo addition after album creation",{err:e}),e})):(o.showTitleError(!0,o.titleError),e.Promise.reject({message:o.titleError}))},addPhotos:function(t,i){for(var o=this,s=[],n=[],r=0;r<i.length;r+=500)s.push(i.slice(r,r+500<i.length?r+500:i.length));return s.forEach(function(e,i){n.push(o.albumsModel.remote.addPhoto({photoID:e.join(","),isMultiplePhotos:!0,photosSelectedIds:o.params.photosSelectedIds,videosSelectedIds:o.params.videosSelectedIds,numberOfPhotosSelected:o.params.numberOfPhotosSelected,numberOfVideosSelected:o.params.numberOfVideosSelected,setID:t,updateItemCounts:0===i},this.appContext))}),e.Promise.all(n).then(function(e){return e&&e[0]?e[0].setModel:null})},focusInitial:function(){this.titleNode&&this.titleNode.focus()}})},"@VERSION@",{requires:["flickr-view","stuff-creation-view"],optional:["set-models"],langBundles:["more-menu-view","common","global-nav","add-to-stuff"]});